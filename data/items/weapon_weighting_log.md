# 武器加权等级计算日志

## 日志格式
每条记录包含：
- 时间戳
- 文件名
- 武器ID
- 武器名称
- 计算的加权等级
- 详细判定理由
- 状态

---

## 计算记录

### 2025-08-29 开始加权计算任务

#### 武器_手枪.xml

| ID | 名称 | 等级 | 价格 | 平均DPS | 加权DPS | 计算加权 | 状态 |
|----|------|------|------|---------|---------|----------|------|
| 8218 | M93R | 21 | 54200 | 255.56 | 383.33 | 0 | 已完成 |
| 8217 | M92F | 12 | 31200 | 119.40 | 119.40 | 0 | 已完成 |
| 8216 | S&W M500 | 33 | 85800 | 1231.88 | 1231.88 | 0 | 已完成 |

---

## 详细分析记录

### M93R (ID: 8218)
**加权等级：0（标准加权）**

**判定理由：**
1. **DPS性能**：平均DPS 255.56，3连发冲锋手枪，使用1.5弹道系数
2. **经济定价**：54,200价格对应21级武器的标准定价范围
3. **获取途径**：无特殊标记，推测为普通掉落
4. **武器定位**：3连发冲锋手枪，特殊机制但无稀有属性
5. **Excel标准**：不满足K点/合成/高价条件

---

### M92F (ID: 8217)
**加权等级：0（标准加权）**

**判定理由：**
1. **DPS性能**：平均DPS 119.40，属于12级手枪标准水平
2. **经济定价**：31,200价格完全符合12级标准定价（价格/等级比=2600）
3. **获取途径**：作为军用制式手枪，无特殊获取限制
4. **武器定位**：标准军用手枪（M9改进型），无特殊强化或稀有属性  
5. **Excel标准**：不满足任何加权加分条件（非K点购买/非合成/非高价）

**综合评估**：
- DPS表现：119.40（基础DPS），符合12级标准
- 加权DPS（等级0）：119.40（无额外系数）
- 价格比率：1.00（完全符合标准）
- 横向对比：性能和价格均与同级别标准手枪一致
- **重要修正**：普通子弹不使用穿刺系数，直接基于平均DPS计算加权
- 最终结论：标准军用手枪，无任何加权理由，weightlevel = 0

---

### S&W M500 (ID: 8216)
**加权等级：0（标准加权）**

**判定理由：**
1. **DPS性能**：平均DPS 1231.88，符合33级大威力手枪标准
2. **获取渠道验证**：普通商店购买（King商店位置31，soldier商店位置26）
3. **经济定价**：85,800价格符合33级大威力手枪标准定价（价格比率1.01）
4. **武器定位**：大威力马格南手枪，斩杀15属性为该类武器标准配置
5. **Excel标准**：不满足任何加权加分条件

**获取渠道检查结果**：
- ✓ 普通商店：`data/shops/shops.json` - King商店、soldier商店
- × K点商店：`data/kshop/*` - 未找到
- × 合成系统：`data/crafting/*` - 未找到  
- × 任务奖励：`data/task/*` - 未找到

**最终结论**：标准大威力手枪，通过普通商店购买，weightlevel = 0

---

## 加权计算方法论

### 操作流程（完整版）

#### 步骤1：提取武器基础属性
从武器XML文件中提取：
- ID、名称、等级、价格
- 单发伤害(power)、射击间隔(interval)、弹夹容量(capacity)
- 分裂数(split)、武器类型(weapontype)
- 子弹类型(bullet)、特殊属性

#### 步骤2：计算平均DPS
**公式**：`平均DPS = 1000 × 单发伤害 / (射击间隔 × (弹夹容量-1) + 900 × 双枪系数)`
- 双枪系数：单枪=1.0，双枪=2.0（手枪）或1.5（长枪）
- **重要**：普通子弹不使用穿刺系数，直接基于平均DPS计算

#### 步骤3：获取渠道验证（关键步骤）
**必须检查以下路径**：
- `data/kshop/*` - K点商店（+1分）
- `data/crafting/*` - 合成系统（+1分）
- `data/shops/*` - 普通商店（0分）
- `data/task/*` - 任务奖励（视情况而定）

**检查命令**：
```bash
# 搜索武器ID或名称
grep "武器ID" data/kshop/* data/crafting/* data/shops/* data/task/*
```

#### 步骤4：Excel标准对照
**参考文件**：`0.说明文件与教程/武器-技能数值-价格-合成表填写的参考公式.xlsx`

**加权加分条件**：
- K点购买：+1分
- 合成获得：+1分  
- 高价商品：+1分（价格显著高于同级标准）
- 特殊活动/开发者武器：+4分

#### 步骤5：加权DPS计算
**公式**：`加权DPS = 平均DPS × 1.1^加权等级`
- 仅用于性能验证，不影响最终判定
- 穿刺系数仅用于穿刺子弹

#### 步骤6：综合判定
**判定优先级**：
1. **获取渠道**（最重要）：直接决定基础加权
2. **价格分析**：验证获取渠道的合理性
3. **特殊属性**：额外考虑因素
4. **横向对比**：最终合理性检查

### 参考资料位置

#### 核心参考文件
1. **Excel计算表**：`0.说明文件与教程/武器-技能数值-价格-合成表填写的参考公式.xlsx`
   - 枪械sheet：DPS计算公式和系数说明
   - 装备价格sheet：价格参考标准

2. **获取渠道检查**：
   - K点商店：`data/kshop/`
   - 合成系统：`data/crafting/`
   - 普通商店：`data/shops/shops.json`
   - 任务奖励：`data/task/`

3. **工作流文档**：
   - `weapon_weighting_workflow.md`：详细计算方法
   - `weapon_weighting_log.md`：本文件，记录所有计算结果

### 计算公式总结

#### DPS计算
```
平均DPS = 1000 × 单发伤害 / (射击间隔 × (弹夹容量-1) + 900 × 双枪系数)
加权DPS = 平均DPS × 1.1^加权等级
```

#### 价格参考估算
```
等级X的标准价格 ≈ 基础价格 × (等级系数^X)
价格比率 = 实际价格 / 标准价格
```

#### 加权等级判定
```
if 在K点商店: +1分
if 在合成系统: +1分
if 高价商品: +1分
if 特殊武器: +1~4分

最终加权等级 = 总得分（最大4分）
```

### 重要发现和经验

1. **获取渠道检查是关键**：单纯依据价格分析容易误判
2. **穿刺系数误区**：仅用于穿刺子弹，普通子弹直接计算
3. **商店定位重要**：不同商店的定位影响加权判断
4. **特殊属性标准化**：如斩杀、马格南弹药通常是该类武器标配

### 加权等级定义
- **-1**：负加权（新手/练习武器）
- **0**：标准加权（普通掉落/商店购买）
- **1**：优质加权（K点购买/合成获得）
- **2**：精良加权（高价商品/稀有掉落）
- **3**：史诗加权（K点+合成+高价）
- **4**：传奇加权（特殊活动/开发者武器）

---

## 待处理清单
- [ ] S&W M500 (ID: 8216)
- [ ] Webley (ID: 8215)
- [ ] WaltherP99C (ID: 8214)
- [ ] 其余86把手枪...

## 备注
- 工作流文档：weapon_weighting_workflow.md
- 每次处理一把武器，确保分析充分
- 记忆模糊时重新阅读工作流文档