# 项目技术架构总览

> 闪客快打7佣兵帝国 MOD 的整体技术架构与模块间关系。

---

## 1. 架构概览

```
┌─────────────────────────────────┐
│     Flash Player (AS2 客户端)     │
│  ┌─────────┐  ┌──────────────┐  │
│  │ 主 SWF   │  │ 子 SWF/小游戏│  │
│  │(游戏逻辑)│←→│  (hana包)    │  │
│  └────┬─────┘  └──────────────┘  │
│       │ XMLSocket                 │
└───────┼───────────────────────────┘
        │
┌───────┼───────────────────────────┐
│  Node.js 本地服务器               │
│  ┌────┴─────┐  ┌──────────────┐  │
│  │XMLSocket │  │  HTTP/REST   │  │
│  │ 服务     │  │   服务       │  │
│  └──────────┘  └──────────────┘  │
│  ┌──────────────────────────────┐│
│  │ 任务处理器(eval/regex/音频等)  ││
│  └──────────────────────────────┘│
└───────────────────────────────────┘
```

---

## 2. 模块通信流程

<!-- TODO: 补充 AS2 客户端与服务器之间的消息协议细节 -->
<!-- TODO: 补充 XML 数据加载流程（data/ → AS2 XML解析） -->
<!-- TODO: 补充子 SWF 加载与通信机制 -->

### AS2 ↔ Node.js 通信
- 协议：XMLSocket（TCP长连接）
- 端口：通过 HTTP `GET /getSocketPort` 获取
- 消息格式：JSON over XMLSocket
- 详细文档：`tools/Local Server/server.md`

### 数据加载
- 游戏数据（XML）：`data/` 目录，运行时由 AS2 XML 解析器加载
- 配置文件（XML）：`config/` 目录，同上
- 跨域策略：`crossdomain.xml`

---

## 3. 代码组织层次

<!-- TODO: 补充各层之间的依赖关系图 -->

| 层次 | 位置 | 职责 |
|------|------|------|
| 帧脚本层 | `scripts/展现/`、`scripts/引擎/`、`scripts/逻辑/`、`scripts/通信/` | 运行在时间轴上的脚本，直接操作舞台 |
| 类库层 | `scripts/类定义/org/flashNight/` | 七大包：核心逻辑与工具的面向对象实现 |
| FLA 资源层 | `flashswf/` | Flash 可视化资源与元件，需 Flash CS6 编辑 |
| 数据层 | `data/`、`config/` | XML 配置与游戏数据，可直接修改 |
| 服务端 | `tools/Local Server/` | Node.js 服务，为 AS2 客户端提供扩展能力 |

---

## 4. 关键技术决策记录

<!-- TODO: 在自优化环节中记录重要的架构决策及其原因 -->

> 此节在自优化环节中逐步填充。
