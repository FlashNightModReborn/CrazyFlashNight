# 自优化工作流

> Agent 会话收尾时的知识归档与文档维护流程。agentsDoc/ 文档体系持续生长的驱动机制。

---

## 1. 触发时机

- 用户明确结束会话前
- 完成较大开发任务后
- 发现重要技术洞察或踩坑经验时
- 用户主动要求归档时

---

## 2. 归档流程

### A. 回顾本次会话

检查是否有以下发现：AS2 怪癖/幻觉模式、性能发现、架构理解、游戏设计决策。

### B. 归档判断

**归档**（满足任一）：跨会话有价值 / 纠正性知识 / 可复用模式 / 用户要求记录。

**不归档**：一次性调试过程 / 已在代码注释中记录 / 未验证的猜测。

### C. 归档目标

| 发现类型 | 归档到 |
|----------|--------|
| AS2 语法/API 幻觉 | `as2-anti-hallucination.md` |
| AS2 性能发现 | `as2-performance.md` |
| 架构理解 | `architecture.md` |
| 编码规范 | `coding-standards.md` |
| 测试方法 | `testing-guide.md` |
| 游戏系统 | `game-systems.md` |
| 游戏设计决策 | `game-design.md` |
| 数据结构 | `data-schemas.md` |
| 跨 Agent 运营知识 | `shared-notes.md` |
| 会话级临时状态 | 各平台私有记忆（见 §3） |

### D. 执行

1. 打开目标文档，找到 `<!-- TODO -->` 或合适位置
2. 追加内容，保持格式一致
3. 填充 TODO 后移除标记

---

## 3. 知识持久化：双轨机制

本项目多 Agent 协作（Claude Code、Codex、Kimi Code、Antigravity 等），持久化分两轨：

**轨道 A：仓库共享** — `agentsDoc/shared-notes.md`（Git 同步）
- 适合：用户偏好、已知坑与 workaround、高频操作备忘
- 不适合：详细技术文档（放对应主题文件）、已在 AGENTS.md 中记录的规则、大段代码、会话临时状态

**轨道 B：平台私有记忆**（不提交仓库）
- Claude Code：`~/.claude/projects/[项目]/memory/MEMORY.md`
- 其他平台：各自会话记忆机制

**决策规则**：对其他 Agent 也有用 → 轨道 A；仅当前会话/Agent 有用 → 轨道 B。

---

## 4. 维护准则

- **渐进式**：每次会话填充一点，不追求一次完善
- **准确性优先**：只记录已验证信息
- **去重**：添加前检查是否已有相同内容
- **格式一致**：遵循各文档已有结构

---

## 5. 文档健康度巡检

定期（或用户要求时）检查：
- `<!-- TODO -->` 标记是否在逐步减少
- 是否有过时或不准确的信息
- 是否有新系统或文件类型需补充索引
- AGENTS.md 场景化索引是否覆盖当前工作场景
