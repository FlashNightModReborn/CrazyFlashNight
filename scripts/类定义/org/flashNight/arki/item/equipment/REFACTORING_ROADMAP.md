# EquipmentUtil é‡æ„è·¯çº¿å›¾

## é‡æ„ç›®æ ‡
å°†1420è¡Œçš„ EquipmentUtil "ä¸Šå¸ç±»"æ‹†åˆ†ä¸ºèŒè´£å•ä¸€çš„æ¨¡å—ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

## AS2 ç¯å¢ƒçº¦æŸ
- æ—  package å…³é”®å­—ï¼Œç±»å¿…é¡»æ”¾åœ¨å®Œæ•´è·¯å¾„ä¸‹
- ä»¥é™æ€æ–¹æ³•ä¸ºä¸»ï¼Œé¿å…è¿‡åº¦å®ä¾‹åŒ–
- æ–°å»ºç±»æ—¶éœ€è¦ UTF-8 with BOM ç¼–ç 
- é¿å… _root ä¾èµ–é“¾

## å®æ–½è¿›åº¦ âœ… = å·²å®Œæˆ | ğŸ”„ = è¿›è¡Œä¸­ | â³ = å¾…å¼€å§‹

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å·¥å…·æå–ï¼ˆä½é£é™©ï¼‰
- âœ… PropertyOperators.as - å±æ€§è¿ç®—å·¥å…·ç±»ï¼ˆå«æµ‹è¯•ç”¨ä¾‹ï¼‰
- âœ… EquipmentCalculator.as - çº¯å‡½æ•°è®¡ç®—ç±»ï¼ˆä¼˜åŒ–äº†O(n^4)åˆ°O(n)ï¼‰
- âœ… EquipmentConfigManager.as - åªè¯»é…ç½®ç®¡ç†å™¨

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—æå–ï¼ˆä¸­é£é™©ï¼‰
- âœ… ModRegistry.as - é…ä»¶æ³¨å†Œè¡¨ï¼ˆå«useSwitchä¼˜åŒ–ï¼‰
- âœ… TagManager.as - æ ‡ç­¾ä¾èµ–ç®¡ç†å™¨
- âœ… TierSystem.as - è¿›é˜¶ç³»ç»Ÿç®¡ç†å™¨

### ç¬¬ä¸‰é˜¶æ®µï¼šä»£ç†å±‚å®ç°ï¼ˆé«˜é£é™©ï¼‰
- âœ… ä¿®æ”¹ EquipmentUtil ä¸ºè–„ä»£ç†ï¼Œè·¯ç”±åˆ°æ–°æ¨¡å—
- âœ… æ·»åŠ å…¼å®¹æ€§æµ‹è¯•ï¼Œç¡®ä¿UIå’ŒTooltipä¸å—å½±å“
- âœ… å¤‡ä»½åŸå§‹ EquipmentUtil.as ä¸º .backup

### ç¬¬å››é˜¶æ®µï¼šè¿ç§»å’Œä¼˜åŒ–
- â³ é€æ­¥è¿ç§»å¤–éƒ¨è°ƒç”¨ç‚¹
- â³ æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- â³ å®Œå–„æ–‡æ¡£

## å…³é”®ä¼˜åŒ–ç‚¹

### 1. useSwitch O(n^4) â†’ O(n) ä¼˜åŒ–
```actionscript
// æ—§ä»£ç ï¼š4å±‚åµŒå¥—å¾ªç¯
for(mods) for(useCases) for(itemUseList) for(branchList)

// æ–°ä»£ç ï¼šæ„å»ºæŸ¥æ‰¾è¡¨
var lookup = buildUseLookup(itemUse, itemWeaponType); // O(n)
if(lookup[branchItem]) return true; // O(1)æŸ¥æ‰¾
```

### 2. çº¯å‡½æ•°è®¾è®¡
- calculatePure() ä¸ä¿®æ”¹è¾“å…¥ï¼Œè¿”å›æ–°å¯¹è±¡
- ä¾¿äºæµ‹è¯•å’Œè°ƒè¯•
- ä¿ç•™ calculate() å…¼å®¹æ—§æ¥å£

### 3. é™æ€æ–¹æ³•ä¸ºä¸»
- é¿å…å•ä¾‹åµŒå¥—
- å‡å°‘ _root ä¾èµ–
- ç®€åŒ–è°ƒç”¨é“¾

## ä¸‹ä¸€æ­¥å·¥ä½œ

### ç«‹å³ä»»åŠ¡ï¼ˆModRegistry.asï¼‰
1. æå–é…ä»¶æ•°æ®ç®¡ç†é€»è¾‘
2. å®ç° useSwitch ä¼˜åŒ–ç®—æ³•
3. å½’ä¸€åŒ–å¤„ç†ï¼ˆpercentage/multiplierï¼‰
4. æ·»åŠ å¿«ç…§æµ‹è¯•

### åç»­ä»»åŠ¡
1. TagManager.as - å¤„ç† requireTags/provideTags/blockedTags
2. TierSystem.as - è¿›é˜¶ææ–™å¯ç”¨æ€§æ£€æŸ¥
3. æ›´æ–° EquipmentUtil è·¯ç”±é€»è¾‘

## æµ‹è¯•ç­–ç•¥
1. å•å…ƒæµ‹è¯•ï¼šæ¯ä¸ªæ–°ç±»éƒ½æœ‰ runTests() æ–¹æ³•
2. å¿«ç…§æµ‹è¯•ï¼šå¯¹æ¯”æ–°æ—§è®¡ç®—ç»“æœ
3. é›†æˆæµ‹è¯•ï¼šç¡®ä¿UIäº¤äº’æ­£å¸¸
4. æ€§èƒ½æµ‹è¯•ï¼šéªŒè¯ä¼˜åŒ–æ•ˆæœ

## é£é™©ç®¡ç†
1. **å…¼å®¹æ€§**ï¼šä¿æŒåŸæ¥å£ï¼Œè–„ä»£ç†å±‚è¿‡æ¸¡
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šé…ç½®åŠ è½½é¡ºåºæ•æ„Ÿï¼Œéœ€ä¸¥æ ¼æµ‹è¯•
3. **æ€§èƒ½é€€åŒ–**ï¼šå…ˆä¼˜åŒ–çƒ­ç‚¹ï¼Œç¼“å­˜ç­‰ä¼˜åŒ–å»¶å

## æ–‡ä»¶ç»“æ„
```
org/flashNight/arki/item/
â”œâ”€â”€ EquipmentUtil.as (åŸç±»ï¼Œæ”¹ä¸ºä»£ç†)
â””â”€â”€ equipment/
    â”œâ”€â”€ PropertyOperators.as      âœ…
    â”œâ”€â”€ EquipmentCalculator.as    âœ…
    â”œâ”€â”€ EquipmentConfigManager.as âœ…
    â”œâ”€â”€ ModRegistry.as            âœ…
    â”œâ”€â”€ TagManager.as             âœ…
    â”œâ”€â”€ TierSystem.as             âœ…
    â”œâ”€â”€ EquipmentTestSuite.as     âœ…
    â””â”€â”€ REFACTORING_ROADMAP.md    âœ…
```

## æµ‹è¯•æ–¹æ³•
```actionscript
// åœ¨æ¸¸æˆä¸­è¿è¡Œå®Œæ•´æµ‹è¯•
EquipmentTestSuite.quickTest();

// æˆ–å•ç‹¬æµ‹è¯•å„æ¨¡å—
PropertyOperators.runTests();
ModRegistry.runPerformanceTest();
TagManager.runTests();
TierSystem.runTests();
```

## æ³¨æ„äº‹é¡¹
- æ¯ä¸ªæ–°æ–‡ä»¶éœ€è¦ UTF-8 with BOM
- import è¯­å¥è¦å®Œæ•´è·¯å¾„
- é™æ€æ–¹æ³•ä¼˜å…ˆ
- ä¿æŒå‘åå…¼å®¹