import org.flashNight.gesh.pratt.*;
// 运行完整的Parser测试
PrattParser_TestSuite.runAllTests();


========== PrattParser 100%覆盖测试开始 ==========

--- 测试分组1：解析器API基础功能 ---
  ✅ 基础parseExpression：应该解析字面量
  ✅ 基础parseExpression：字面量值应该正确
  ✅ 基础parse：应该解析字面量
  ✅ 基础parse：字面量值应该正确
  ✅ getCurrentToken：应该返回当前token
  ✅ consume：应该返回并消费当前token
  ✅ consume后：当前token应该前进
  ✅ match：应该正确匹配token类型
  ✅ match：应该正确识别不匹配的类型
  ✅ matchText：应该正确匹配token文本
  ✅ matchText：应该正确识别不匹配的文本
  ✅ consumeExpected：应该返回期望的token
  ✅ getPrecedence：乘法运算符应该有非零优先级
  ✅ 空输入：应该立即返回EOF
  ✅ 完整解析：应该成功解析表达式
  ✅ AST toString：应该生成非空字符串表示

--- 测试分组2：运算符优先级 ---
  ✅ 乘法优先级：2 + 3 * 4应该等于14，不是20
  ✅ 除法优先级：10 - 6 / 2应该等于7，不是2
  ✅ 除法优先级2：8 / 2 + 3应该等于7
  ✅ 幂运算优先级：2 * 3 ** 2应该等于18，不是36
  ✅ 幂运算优先级2：12 / 2 ** 2应该等于3
  ✅ 一元运算符优先级：-2 ** 2应该等于-4
  ✅ 逻辑非优先级：!false && true应该为true
  ✅ 比较优先级：5 + 3 > 7应该为true
  ✅ 相等比较优先级：10 - 5 == 5应该为true
  ✅ 逻辑运算符优先级：true || false && false应该为true
  ✅ 逻辑与优先级：5 > 3 && 2 < 4应该为true
  ✅ 逻辑或优先级：5 > 10 || 3 < 4应该为true
  ✅ 三元运算符优先级：true ? 5 + 3 : 2 * 4应该等于8
  ✅ 三元运算符优先级2：2 + 3 > 4 ? 10 : 20应该等于10
  ✅ 空值合并优先级：null ?? 5 + 3应该等于8
  ✅ 复杂优先级：2 + 3 * 4 ** 2 - 1应该等于49
  ✅ 复杂逻辑优先级：!false && 5 > 3 || 2 == 3应该为true

--- 测试分组3：运算符结合性 ---
  ✅ 左结合减法：10 - 5 - 2应该等于3，不是7
  ✅ 左结合加法：2 + 3 + 4应该等于9
  ✅ 左结合除法：20 / 4 / 2应该等于2.5，不是10
  ✅ 左结合乘法：2 * 3 * 4应该等于24
  ✅ 右结合幂运算：2 ** 3 ** 2应该等于512，不是64
  ✅ 右结合幂运算2：3 ** 2 ** 2应该等于81
  ✅ 三元运算符右结合：true ? false ? 1 : 2 : 3应该等于2
  ✅ 三元运算符右结合2：false ? 1 : true ? 2 : 3应该等于2
  ✅ 比较运算符左结合：5 > 3 > 1应该为false
  ✅ 逻辑与左结合：true && false && true应该为false
  ✅ 逻辑或左结合：false || false || true应该为true
  ✅ 混合结合性：2 ** 3 * 4应该等于32
  ✅ 混合结合性2：16 / 2 ** 3应该等于2
  ✅ 复杂左结合：10 - 5 + 3 - 2应该等于6
  ✅ 复杂右结合验证：显式分组应该等于隐式右结合

--- 测试分组4：前缀表达式解析 ---
  ✅ 数字字面量：42应该正确解析
  ✅ 数字字面量：3.14应该正确解析
  ✅ 数字字面量：0应该正确解析
  ✅ 数字字面量：123.456应该正确解析
  ✅ 字符串字面量："hello"应该正确解析
  ✅ 字符串字面量：'world'应该正确解析
  ✅ 字符串字面量：""应该正确解析
  ✅ 字符串字面量：'test'应该正确解析
  ✅ 布尔字面量：true应该解析为true
  ✅ 布尔字面量：false应该解析为false
  ✅ null字面量：null应该解析为null
  ✅ undefined字面量：undefined应该解析为undefined
  ✅ 标识符解析：myVar应该正确解析
  ✅ 标识符解析：_private应该正确解析
  ✅ 标识符解析：$special应该正确解析
  ✅ 标识符解析：camelCase应该正确解析
  ✅ 标识符解析：under_score应该正确解析
  ✅ 基础分组：(42)应该等于42
  ✅ 分组运算：(2 + 3)应该等于5
  ✅ 分组优先级：(2 + 3) * 4应该等于20
  ✅ 分组优先级2：2 * (3 + 4)应该等于14
  ✅ 嵌套分组：((2 + 3) * (4 + 1))应该等于25
  ✅ 复杂嵌套分组：(2 + (3 * (4 + 1)))应该等于17
  ✅ 分组一元运算：-(2 + 3)应该等于-5
  ✅ 分组逻辑非：!(true && false)应该为true
  ✅ 正号运算符：+42应该等于42
  ✅ 正号嵌套：+(-5)应该等于-5
  ✅ 负号运算符：-42应该等于-42
  ✅ 负号嵌套：-(-5)应该等于5
  ✅ 逻辑非：!true应该为false
  ✅ 逻辑非：!false应该为true
  ✅ 双重逻辑非：!!true应该为true
  ✅ typeof运算符：typeof 42应该为'number'
  ✅ typeof运算符：typeof true应该为'boolean'
  ✅ typeof运算符：typeof "hello"应该为'string'
  ✅ 一元二元组合：-5 + 3应该等于-2
  ✅ 一元逻辑组合：!true || false应该为false
  ✅ 一元分组组合：-(2 + 3) * 2应该等于-10

--- 测试分组5：中缀表达式解析 ---
  ✅ 加法运算符：5 + 3应该等于8
  ✅ 减法运算符：10 - 4应该等于6
  ✅ 乘法运算符：6 * 7应该等于42
  ✅ 除法运算符：15 / 3应该等于5
  ✅ 取模运算符：10 % 3应该等于1
  ✅ 幂运算符：2 ** 3应该等于8
  ✅ 相等运算符：5 == 5应该为true
  ✅ 不等运算符：5 != 3应该为true
  ✅ 严格相等：5 === 5应该为true
  ✅ 严格不等：5 !== "5"应该为true
  ✅ 小于运算符：3 < 5应该为true
  ✅ 大于运算符：7 > 4应该为true
  ✅ 小于等于：5 <= 5应该为true
  ✅ 大于等于：6 >= 6应该为true
  ✅ 逻辑与：true && true应该为true
  ✅ 逻辑或：false || true应该为true
  ✅ 空值合并：null ?? "default"应该为'default'
  ✅ 空值合并非null：42 ?? "default"应该为42
  ✅ 基础三元：true ? "yes" : "no"应该为'yes'
  ✅ 基础三元假：false ? "yes" : "no"应该为'no'
  ✅ 表达式条件三元：5 > 3 ? 10 : 20应该为10
  ✅ 表达式条件三元2：2 + 2 == 5 ? 100 : 200应该为200
  ✅ 表达式分支三元：true ? 5 + 3 : 2 * 4应该为8
  ✅ 表达式分支三元2：false ? 5 + 3 : 2 * 4应该为8
  ✅ 嵌套三元：true ? (false ? 1 : 2) : 3应该为2
  ✅ 链式三元：false ? 1 : true ? 2 : 3应该为2
  ✅ 三元复杂表达式：5 > 3 ? 10 + 5 : 20 - 5应该为15
  ✅ 三元逻辑组合：true && false ? true : false || true应该为true
  ✅ 无参数函数调用：noArgs()应该正确调用
  ✅ 单参数函数调用：identity(42)应该返回42
  ✅ 多参数函数调用：add(5, 3)应该返回8
  ✅ 三参数函数调用：multiply(2, 3, 4)应该返回24
  ✅ 表达式参数：add(2 + 3, 4 * 2)应该返回13
  ✅ 复杂表达式参数：add(5 > 3 ? 10 : 5, 2 ** 3)应该返回18
  ✅ 对象方法调用：Math.max(10, 20)应该返回20
  ✅ 对象方法调用2：obj.method(5)应该返回10
  ✅ 嵌套函数调用：add(identity(5), identity(3))应该返回8
  ✅ 深度嵌套调用：add(add(1, 2), add(3, 4))应该返回10
  ✅ 函数调用二元组合：add(5, 3) * 2应该返回16
  ✅ 函数调用三元组合：add(5, 3) > 7 ? 100 : 200应该返回100
  ✅ 基础属性访问：user.name应该返回'Alice'
  ✅ 数字属性访问：user.age应该返回25
  ✅ 布尔属性访问：config.debug应该返回true
  ✅ 嵌套属性访问：user.profile.email应该正确
  ✅ 深度嵌套属性：user.profile.settings.theme应该返回'dark'
  ✅ 属性访问二元组合：user.age + 5应该返回30
  ✅ 属性访问比较：user.age > 20应该为true
  ✅ 属性访问三元：config.debug ? "debug" : "production"应该返回'debug'
  ✅ 属性访问函数参数：greet(user.name)应该返回'Hello, Alice'
  ✅ 基础数组访问：numbers[0]应该返回1
  ✅ 数组访问：numbers[2]应该返回3
  ✅ 字符串数组访问：strings[1]应该返回'world'
  ✅ 变量索引：numbers[index]应该返回2
  ✅ 表达式索引：numbers[1 + 1]应该返回3
  ✅ 复杂表达式索引：numbers[5 - 3]应该返回3
  ✅ 嵌套数组访问：nested[0][1]应该返回2
  ✅ 嵌套数组访问2：nested[1][0]应该返回3
  ✅ 对象数组属性：objects[0].name应该返回'Alice'
  ✅ 对象数组属性2：objects[1].age应该返回30
  ✅ 数组访问二元组合：numbers[0] + numbers[1]应该返回3
  ✅ 数组访问比较：numbers[4] > numbers[0]应该为true
  ✅ 数组访问三元：numbers[0] > 0 ? numbers[1] : numbers[2]应该返回2

--- 测试分组6：数组字面量解析 ---
  ✅ 空数组字面量：[]应该创建空数组
  ✅ 空数组AST：应该创建ARRAY_LITERAL类型
  ✅ 空数组toString：应该包含ArrayLiteral
  ✅ 单元素数组：[42]应该正确创建
  ✅ 单字符串数组：["hello"]应该正确创建
  ✅ 多元素数组：[1, 2, 3]应该正确创建
  ✅ 混合类型数组：应该正确处理不同类型元素
  ✅ 标识符数组：[x, y, name]应该正确求值
  ✅ 表达式数组：[x + y, x * y, -value]应该正确计算
  ✅ 嵌套数组：[[1, 2], [3, 4], []]应该正确创建
  ✅ 函数调用数组：[add(1, 2), add(x, y)]应该正确执行
  ✅ 复杂表达式数组：应该正确处理三元和函数调用
  ✅ 数组字面量属性：[1, 2, 3].length应该返回3
  ✅ 数组字面量索引：["first", "second", "third"][1]应该返回'second'
  ✅ 复杂嵌套访问：[[1, 2], [3, 4]][0][1]应该返回2
  ✅ 数组字面量参数：sum([1, 2, 3, 4])应该返回10
  ✅ 数组字面量三元：应该返回正确的数组分支
  ✅ 数组字面量二元：[1, 2, 3].length + [4, 5].length应该等于5
  ✅ 复杂数组AST：应该包含ArrayLiteral节点
  ✅ 复杂数组AST：应该包含Binary子节点
  ✅ 数组字面量解析精度：应该正确处理运算符优先级

--- 测试分组6.5：对象字面量解析 ---
  ✅ 对象字面量：空对象应该正确解析
  ✅ 对象字面量：简单键值对应该正确
  ✅ 对象字面量：字符串键应该正确处理
  ✅ 对象字面量：值可以是表达式
  ✅ 对象字面量：应该支持嵌套对象
  ✅ 对象字面量：应该支持嵌套数组
  ✅ 对象字面量：应该支持尾随逗号
  ✅ 对象字面量：应该支持直接属性访问
  ✅ 对象字面量错误：缺少冒号应该抛错
  ✅ 对象字面量错误：缺少值应该抛错
  ✅ 对象字面量错误：数字键应该抛错
  ✅ 对象字面量错误：缺少右大括号应该抛错

--- 测试分组7：复杂嵌套解析 ---
  ✅ 复杂访问：users[0].scores[1]应该返回92
  ✅ 复杂访问2：users[1].name应该返回'Bob'
  ✅ 函数复杂访问：Math.max(users[0].scores[0], users[0].scores[1], users[0].scores[2])应该返回92
  ✅ 函数复杂访问2：Math.avg(users[1].scores)应该约等于91
  ✅ 复杂条件：users[0].active && users[0].scores[0] > config.passing ? "pass" : "fail"应该返回'pass'
  ✅ 复杂嵌套条件应该返回'inactive'
  ✅ 复杂算术：平均分计算应该约等于85
  ✅ 复杂算术2：应该约等于98.5
  ✅ 超复杂嵌套表达式应该返回false
  ✅ 多层函数嵌套：应该返回较大的平均分91
  ✅ 复杂三元嵌套：应该返回93.5
  ✅ 超级复杂表达式：应该返回99
  ✅ 数组字面量复杂表达式：应该约等于83.33
  ✅ 数组字面量三元复杂：应该返回Alice的激活状态数组
  ✅ 嵌套数组字面量复杂：应该返回92
  ✅ 深度数组函数嵌套：应该约等于89

--- 测试分组8：语法错误处理 ---
  ✅ 连续运算符错误：5 + * 3应该抛出语法错误
  ✅ 不匹配括号错误：(5 + 3应该抛出语法错误
  ✅ 多余括号错误：5 + 3)应该抛出语法错误
  ✅ 不完整三元1：true ? 5应该抛出语法错误
  ✅ 不完整三元运算符错误2：true ? 5 :应该抛出语法错误
  ✅ 不匹配方括号错误：arr[5应该抛出语法错误
  ✅ 函数参数错误：func(5,)应该抛出语法错误
  ✅ 函数参数错误2：func(5,, 3)应该抛出语法错误
  ✅ 空分组错误：()应该抛出语法错误
  ✅ 多余token错误：5 + 3 4应该抛出语法错误
  ✅ 二元运算符开头错误：* 5应该抛出语法错误
  ✅ 运算符结尾错误：5 +应该抛出语法错误
  ✅ 数字属性名错误：obj.123应该抛出语法错误
  ✅ 数组字面量不匹配方括号：[1, 2, 3应该抛出语法错误
  ✅ 数组字面量连续逗号：[1,, 3]应该抛出语法错误
  ✅ 数组字面量尾逗号：[1, 2,]应该被正确解析
  ✅ 数组字面量无效表达式：[1, +, 3]应该抛出语法错误
  ✅ 嵌套数组字面量不匹配：[[1, 2], [3, 4]应该抛出语法错误
  ✅ 数组字面量混合错误：[1, 2] + [应该抛出语法错误

--- 测试分组9：解析器状态管理 ---
  ✅ 状态管理：第一个token应该是5
  ✅ 状态管理：consumeExpected应该返回+运算符
  ✅ consumeExpected错误：应该包含Expected
  ✅ consumeExpected错误：期望类型不匹配应该抛出错误
  ✅ 状态管理：match应该正确识别标识符
  ✅ 状态管理：match应该正确识别非数字
  ✅ 状态管理：matchText应该正确匹配文本
  ✅ 状态管理：matchText应该正确识别不匹配
  ✅ 优先级管理：加法优先级应该低于乘法
  ✅ 优先级管理：乘法优先级应该低于幂运算
  ✅ parseExpression(0)：应该解析完整表达式
  ✅ parseExpression(7)：应该只解析第一个字面量
  ✅ EOF状态：空输入应该立即是EOF
  ✅ EOF优先级：EOF的优先级应该是0
  ✅ 解析器重用：第一次解析应该正确
  ✅ 解析器重用：重新初始化后应该正确
  ✅ 数组状态：应该正确识别左方括号
  ✅ 数组状态：应该识别第一个数字
  ✅ 数组状态：应该识别逗号
  ✅ 数组状态：应该识别第二个数字

--- 测试分组10：自定义扩展 ---
  ✅ 自定义扩展：addBuffOperators方法应该存在且可调用
  ✅ 自定义扩展：registerPrefix方法应该存在
  ✅ 自定义扩展：registerInfix方法应该存在
  ✅ 扩展基础：基本运算符应该正常工作
  ✅ 扩展架构：PrattParselet类应该存在
  ✅ Parselet工厂：literal()应该创建有效的parselet
  ✅ Parselet工厂：binaryOperator()应该创建有效的parselet
  ✅ Parselet工厂：prefixOperator()应该创建有效的parselet
  ✅ Parselet工厂：arrayLiteral()应该创建有效的parselet
  ✅ Parselet类型：identifier应该是前缀类型
  ✅ Parselet类型：identifier不应该是中缀类型
  ✅ Parselet类型：binaryOperator不应该是前缀类型
  ✅ Parselet类型：binaryOperator应该是中缀类型
  ✅ Parselet类型：arrayLiteral应该是前缀类型
  ✅ Parselet类型：arrayLiteral不应该是中缀类型
  ✅ Parselet优先级：应该返回正确的优先级值
  ✅ Parselet优先级：arrayLiteral应该有优先级0
  ✅ 扩展兼容性：添加自定义运算符后基础功能应该仍然正常
  ✅ 扩展兼容性：数组字面量在扩展后应该仍然工作

--- 测试分组11：边界条件 ---
  ✅ 空输入：应该产生解析错误
  ✅ 纯空白输入：应该产生解析错误
  ✅ 单token：应该正确解析
  ✅ 极长表达式：应该正确计算长加法链
  ✅ 深度嵌套括号：应该正确解析
  ✅ 深度嵌套属性：应该正确访问
  ✅ 深度嵌套数组：应该正确访问
  ✅ 大量参数函数：应该正确传递所有参数
  ✅ 极大数字：应该被解析为数字类型
  ✅ 极小数字：应该被解析为数字类型
  ✅ 极长字符串：应该保持完整长度
  ✅ 复杂标识符：应该正确解析复杂名称
  ✅ 混合复杂表达式：应该正确处理所有语法元素
  ✅ 极大数组字面量：应该正确处理100个元素
  ✅ 深度嵌套数组字面量：应该正确创建20层嵌套
  ✅ 复杂数组元素：应该正确处理各种表达式类型
  ✅ 空数组边界：应该创建长度为0的数组
  ✅ 单元素数组边界：应该正确处理null元素
  ✅ 极值数组：应该正确处理各种极值

--- 测试分组12：解析精度验证 ---
  ✅ AST结构：二元表达式应该产生正确的AST
  ✅ AST结构：分组应该影响AST结构
  ✅ 优先级AST：乘法应该是加法的右操作数
  ✅ 结合性AST：应该体现左结合
  ✅ 函数调用AST：应该产生FunctionCall节点
  ✅ 属性访问AST：应该产生PropertyAccess节点
  ✅ 数组访问AST：应该产生ArrayAccess节点
  ✅ 三元运算符AST：应该产生Ternary节点
  ✅ 一元运算符AST：应该产生Unary节点
  ✅ 数组字面量AST：应该产生ArrayLiteral节点
  ✅ 数组字面量AST：应该包含所有元素
  ✅ 嵌套数组字面量AST：应该产生ArrayLiteral节点
  ✅ 嵌套数组字面量AST：应该包含多个ArrayLiteral节点
  ✅ 复杂AST求值：func(5+1, !false ? 2 : 3) = 8
  ✅ 解析精度：解析的AST应该与手动构建的AST产生相同结果
  ✅ 数组字面量解析精度：解析的AST应该与手动构建的AST产生相同结果
  ✅ 边界精度：0应该精确解析
  ✅ 边界精度：false应该精确解析
  ✅ 边界精度：null应该精确解析
  ✅ 边界精度：""应该精确解析
  ✅ 边界精度：true应该精确解析
  ✅ 边界精度：[]应该精确解析为空数组
  ✅ 边界精度：[null]应该精确解析
  ✅ 数组表达式精度：应该正确计算数组中的表达式

--- 测试分组13：性能边界情况 ---
  ✅ 大量运算符：应该正确计算结果
  ✅ 大量运算符性能：解析时间应该在合理范围内
  ✅ 深度递归：应该正确计算结果
  ✅ 深度递归性能：解析时间应该在合理范围内
  ✅ 大量变量：应该正确计算结果
  ✅ 大量变量性能：解析时间应该在合理范围内
  ✅ 复杂性能：应该产生数字结果
  ✅ 复杂性能：解析时间应该高效
  ✅ 内存使用：重复解析应该保持高效
  ✅ 创建开销：解析器创建应该高效
  ✅ 大型数组字面量：应该正确创建200个元素
  ✅ 大型数组字面量性能：解析时间应该在合理范围内
  ✅ 深度嵌套数组字面量：应该产生对象结果
  ✅ 深度嵌套数组字面量性能：解析时间应该在合理范围内
  ✅ 复杂数组字面量：应该正确创建50个元素
  ✅ 复杂数组字面量性能：解析时间应该在合理范围内
  ✅ 混合数组表达式：应该正确计算结果
  ✅ 混合数组表达式性能：解析时间应该高效
性能测试总结：
  大量运算符: 9ms
  深度递归: 6ms
  大量变量: 6ms
  复杂表达式: 1ms
  重复解析: 56ms
  创建开销: 11ms
  大型数组字面量: 15ms
  深度嵌套数组: 2ms
  复杂数组表达式: 30ms
  混合数组表达式: 1ms

========== PrattParser 测试结果 ==========
总计: 316 个测试
通过: 316 个
失败: 0 个
覆盖率: 100%
✅ PrattParser 所有测试通过！
==========================================
